<!DOCTYPE html>
<html>
<head>
	<title>Comp 20: Assignment #4</title>
	<meta charset="utf-8">

</head>
<body>
	<h1 class = "heading" > Comp20: Assignment #4</h1>
	<h2 class = "heading"> Spring 2018</h2>
	<h3> <span class = "heading"> Assignment Written by: </span> Janith Kulatunge <br>
		<span class ="heading"> App Developed by: </span> Noah Hill </h3>
		<a href="https://lit-temple-18109.herokuapp.com/"> Link to App </a>

	<h4> Introduction</h4> 
	<p> </p>

	<h4> Methodology</h4> 
	<p> </p>

	<h4> Abstract of Findings</h4> 
	<p> </p>

	<h4> Issues found</h4> 
		<p> 
			<div class ="issue"> 
				<ul>
					<li> Issue: Broken Authentication/ Sensitive Data Exposure</li>
					<li> Location: POST /rides API </li>
					<li> Severity: High </li>
					<li> Description: Despite not being a driver, I am able to act as one by setting the username that I send to the server as a driver's (JANET in this case). This gives me access to the position data of all passengers, even though I am not actually a driver. If an app like Uber used this implementation, all an attacker has to do is correctly guess a driver's username, to gain access to sensitive data from recent passengers. </li>
					<li> Proof: 
						Screenshot shows data for numerous passengers being sent to server, followed by data for JANET
						<img src = "/AuthTerm.png" alt = "screenshot showing some passenger data being sent to server followed by JANET user, which returns all passenger data"/></li>
					<li> Resolution: Add user authentication to the site. Would be best to use existing framework, such as Passport.js. </li>
				</ul>
			</div>

			<div class ="issue"> 
				<ul>
					<li> Issue: Cross Site Scripting</li>
					<li> Location: POST /rides API and GET / (home) </li>
					<li> Severity: High. XSS vulnerabilities are often preyed upon by attackers. They allow often attackers manipulate client side Javascript, by submitting strings of code within POST requests. </li>
					<li> Description: Javascript commands (sent to rides API as data) are accepted by the server and inserted into database in the exact format and syntax that they were received in </li>
					<li> Proof: <br> 
						<p> The first screenshot shows Javascript being sent to server, as "username," using curl in the Terminal. Server accepts string and inserts into database. The second screenshot, of mLab window, shows document containing Javascript in database collection. The final screenshot shows the alert window, which was encoded in the XSS request, opened as the home page tries to display passenger list. <br> </p>
						<img src = "/XSSerror.png" alt = "screenshot showing no error being returned by site when Javascript sent"/>
						<img src = "/XSSinDB.png" alt = "screenshot of collection, from mLab, showing Javascript in database" /> 
						<img src = "/XSSalert.png" alt = "screenshot of app client showing alert window encoded in XSS submission" /></li>
					<li> Resolution: Insert following line of code between lines 57 and 58 of index.js to sanitize input and remove special characters from username sent by client <br> 
						<code> username = username.replace(/[^\w\s]/gi, ''); </code> <br> </li> 
				</ul>
			</div>

			<div class ="issue"> 
				<ul>
					<li> Issue: MongoDB Injection</li>
					<li> Location: GET /vehicles.json API </li>
					<li> Severity: High </li>
					<li> Description: This API is supposed to return data on the specific username given, if it exists. By adding $gt to the username requested (see screenshots for syntax), all entries in the database that are greater than the query string username are returned.  </li>
					<li> Proof: </li>
					<li> Resolution: Implement the same line of code for input sanitization, that is shown for the XSS issue. <br> 
						<code> username = username.replace(/[^\w\s]/gi, ''); </code> <br>  </li>
				</ul>
			</div>

	</p>


	<h4> Conclusion</h4> 
	<p> </p>

	<h4> References</h4> 
	<p> </p>


</body>
</html>